---
title: "Centering Treatments"
author: "Art Eschenlauer"
date: "11/16/2019"
output:
  html_document:
    df_print: paged
    toc: no
    toc_depth: '4'
  pdf_document:
    highlight: null
    number_sections: no
    toc: no
    toc_depth: 4
  knitr:::html_vignette:
    fig_caption: yes
    toc: no
    toc_depth: 4
subtitle: Advanced function for 'W4M Data Subset'
vignette: |
  %\VignetteIndexEntry{Centering Treatments}
  \usepackage[utf8]{inputenc}
  \usepackage[all]{nowidow}
  \widowpenalty10000
  \clubpenalty10000
  %\VignetteEngine{knitr::rmarkdown}
# build vignette with rmarkdown::render("vignettes/centering-enhancement.Rmd", "all")
---

# Summary

An extension to convert a data matrix for a replicated design to a data matrix having one column per treatment.   

## Motivation

W4M does not have tools to contrast treaments *per se*.  Sample metadata annotations can indicate replicates of a common treatment, but predictive tools like Heat Map (i.e., hierarchical clustering) and Multivariate (running as PLS-DA) can predict multiple predicted treatments for samples from the same treatment.  This confounds examination of relationships among the treatments themselves.

This example collapses a data matrix having one column per sample to a data matrix having one column per treatment.  Each column is the "center" for the respective set of replicates for that treatment.  Normally distributed data may be analayzed using mean and standard deviation respectively for assessment of the center and the spread; data with unknown distribution, with median and the median absolute deviation.

The resulting treatment metadata include the following column:

- `trt`, the name of the treatment (i.e., the content of a specified column from `sampleMetadata`)
- `n`, the number of replicates for the treatment
- `relative_distance`, which indicates the ratio of the spread of the replicates for the treatment to the spread between the treatments.

## Normally distributed data

For an example with normally distributed data, for each of $m$ treatments $i$ and each of $n_i$ replicates $p$ for each feature $j$:

$$ center_{{treatment_i},{intensity_j}} = mean(intensity_{i,j,p} \; \forall p \in [1,n_i]) $$ 

$$ \text{distance}_{treatment_i} = \sqrt{\sum_{k=1}^j \Big(stdev(intensity_{i,k,p} \; \forall p \in [1,n_i])\Big)^2} $$
$$ \text{center}_{overall,{intensity_j}} = mean(\text{center}_{{treatment_i},{intensity_j}} \; \forall i \in [1,m]) $$ 
$$ \text{distance}_{overall} = \sqrt{\sum_{k=1}^m \Big(stdev(\text{center}_{{treatment_i},{intensity_k}})\Big)^2} $$
$$ \text{relative distance}_{treatment_i} = \frac{\text{distance}_{treatment_i}}{\text{distance}_{overall}}$$

## Unkown distribution

For an example with data having an unknown distribution, for each of $m$ treatments $i$ and each of $n_i$ replicates $p$ for each feature $j$:

$$ center_{{treatment_i},{intensity_j}} = median(intensity_{i,j,p} \; \forall p \in [1,n_i]) $$ 

$$ \text{distance}_{treatment_i} = \sqrt{\sum_{k=1}^j \Big(mad(intensity_{i,k,p} \; \forall p \in [1,n_i])\Big)^2} $$
$$ \text{center}_{overall,{intensity_j}} = median(\text{center}_{{treatment_i},{intensity_j}} \; \forall i \in [1,m]) $$ 
$$ \text{distance}_{overall} = \sqrt{\sum_{k=1}^m \Big(mad(\text{center}_{{treatment_i},{intensity_k}})\Big)^2} $$
$$ \text{relative distance}_{treatment_i} = \frac{\text{distance}_{treatment_i}}{\text{distance}_{overall}}$$
